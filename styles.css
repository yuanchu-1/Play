:root {
  --bg: #0b1020;
  --card: #121937;
  --text: #e8ecf7;
  --accent: #7aa6ff;
  --accent-2: #ffcc6a;
}

* { box-sizing: border-box; }
html, body { height: 100%; }
body {
  margin: 0;
  font-family: 'Noto Sans SC', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  background: radial-gradient(1200px 800px at 80% 120%, #111a3a 0%, #0b1020 60%, #090d19 100%);
  color: var(--text);
}

#app { min-height: 100vh; position: relative; }
.season-tag { position: fixed; left: 16px; bottom: 16px; opacity: 0.7; letter-spacing: 6px; font-weight: 800; color: #9fb6ff; }

#snow-layer { position: fixed; inset: 0; pointer-events: none; }
#snowCanvas { width: 100%; height: 100%; display: block; }

.modal-backdrop {
  position: fixed; inset: 0; display: grid; place-items: center;
  background: rgba(9, 13, 25, 0.6);
  backdrop-filter: blur(4px);
}
.modal {
  width: min(520px, 92vw);
  background: linear-gradient(180deg, #18224a 0%, #121937 100%);
  border: 1px solid #243065;
  border-radius: 16px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.45);
  overflow: hidden;
}
.titlebar {
  display: flex; align-items: center; gap: 10px;
  padding: 14px 18px; border-bottom: 1px solid #243065;
  background: linear-gradient(180deg, rgba(32, 46, 92, 0.7) 0%, rgba(18,25,55,0.7) 100%);
}
.titlebar .icon { font-size: 20px; }
.titlebar .title { font-weight: 700; letter-spacing: 0.5px; }
.content { padding: 16px 18px; line-height: 1.8; color: #cfd7ef; }
.actions { padding: 18px; display: flex; justify-content: flex-end; }
.btn {
  appearance: none; border: none; cursor: pointer;
  padding: 10px 16px; border-radius: 10px; font-weight: 600;
}
.btn.primary {
  background: linear-gradient(180deg, #8ab2ff 0%, #5a88ff 100%);
  color: #0b1020; box-shadow: 0 6px 20px rgba(122, 166, 255, 0.45);
}
.btn.primary:active { transform: translateY(1px); }

#controls { position: fixed; right: 16px; bottom: 16px; }
.btn.control {
  background: linear-gradient(180deg, #ffd29b 0%, #ffb56b 100%);
  color: #3a250e; box-shadow: 0 6px 20px rgba(255, 181, 107, 0.45);
}

#popup-layer { position: fixed; inset: 0; pointer-events: none; }
.popup {
  position: absolute; left: var(--x); top: var(--y);
  transform: translate(-50%, -50%);
  background: linear-gradient(180deg, var(--c1, #2b2436) 0%, var(--c2, #1f1a2c) 100%);
  color: #e8ecf7; border: 1px solid var(--cBorder, #2a356a);
  border-radius: 12px; box-shadow: 0 12px 30px rgba(0,0,0,0.4);
  padding: 12px 16px; font-size: 14px; min-width: 160px;
  opacity: 0;
}
.popup.heart { transition: left 800ms ease, top 800ms ease; }
.popup .title { font-weight: 700; margin-bottom: 6px; }
.popup .desc { color: #b8c3e6; }
.popup .close { position: absolute; right: 8px; top: 8px; opacity: 0.7; }
@keyframes popin {
  from { opacity: 0; transform: translate(-50%, -42%) scale(0.98); }
  to   { opacity: 1; transform: translate(-50%, -50%) scale(1); }
}

/* 出现特效变体 */
.popup.effect-zoom { animation: popinZoom 420ms cubic-bezier(.2,.7,.2,1) forwards; }
.popup.effect-slide { animation: popinSlide 480ms cubic-bezier(.2,.7,.2,1) forwards; }
.popup.effect-float { animation: popinFloat 520ms ease-out forwards; }
.popup.effect-bounce { animation: popinBounce 560ms cubic-bezier(.2,.7,.2,1.2) forwards; }
.popup.effect-sway { animation: popinSway 600ms ease-out forwards; }

@keyframes popinZoom {
  from { opacity: 0; transform: translate(-50%, -60%) scale(0.82); filter: saturate(0.8); }
  to   { opacity: 1; transform: translate(-50%, -50%) scale(1); filter: saturate(1); }
}
@keyframes popinSlide {
  from { opacity: 0; transform: translate(-50%, -65%) scale(0.96); }
  60%  { opacity: 1; transform: translate(-50%, -48%) scale(1.02); }
  to   { opacity: 1; transform: translate(-50%, -50%) scale(1); }
}
@keyframes popinFloat {
  from { opacity: 0; transform: translate(-50%, -54%) scale(0.97); filter: blur(1px); }
  to   { opacity: 1; transform: translate(-50%, -50%) scale(1); filter: blur(0); }
}

@keyframes popinBounce {
  0%   { opacity: 0; transform: translate(-50%, -65%) scale(0.88); }
  60%  { opacity: 1; transform: translate(-50%, -48%) scale(1.06); }
  80%  { transform: translate(-50%, -52%) scale(0.98); }
  100% { transform: translate(-50%, -50%) scale(1); }
}
@keyframes popinSway {
  0%   { opacity: 0; transform: translate(calc(-50% - 10px), -60%) rotate(-1.5deg) scale(0.95); }
  50%  { opacity: 1; transform: translate(calc(-50% + 8px), -50%) rotate(1.2deg) scale(1.02); }
  100% { transform: translate(-50%, -50%) rotate(0deg) scale(1); }
}

.corner-balls { position: fixed; right: 16px; bottom: 16px; inset: auto; }
.ball {
  width: 22px; height: 22px; border-radius: 50%;
  background: radial-gradient(circle at 30% 30%, #fff 0%, #7aa6ff 15%, #3956aa 60%, #1f2d6a 100%);
  filter: blur(0.3px);
  opacity: 0.5;
}
.ball-a { position: absolute; right: 0; bottom: 0; }
.ball-b { position: absolute; right: 28px; bottom: 18px; opacity: 0.35; }

.hidden { display: none !important; }

/* 心形布局辅助：在过渡阶段提升层级避免遮挡 */
.heart-phase .popup { z-index: 10; }